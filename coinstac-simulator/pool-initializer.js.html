<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>pool-initializer.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-simulator.html">simulator</a><ul class='methods'><li data-type='method'><a href="module-simulator.html#.run">run</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">pool-initializer.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

const pdbsConfig = require('./.pouchdb-server-config');
const common = require('coinstac-common');
const DBRegistry = require('coinstac-common').services.dbRegistry.DBRegistry;
DBRegistry.Pouchy.plugin(require('pouchdb-adapter-memory'));
const dbRegistryFactory = common.services.dbRegistry;
const computationRegistryFactory = common.services.computationRegistry;

/**
 * @private
 * @module pool-initializer
 * @description utility to generate PipelineRunnerPool inputs, used by
 * compute client and compute servers
 */
module.exports = {

  /**
   * get a functional set of constructor opts for a PipelineRunnerPool
   * @returns {Promise}
   */
  getPoolOpts(opts) {
    if (!opts) { throw new ReferenceError('opts required'); }
    return Promise.all([
      computationRegistryFactory({ registry: [] }),
      this.getDBRegistry(opts.dbRegistry),
    ])
    .then((r) => ({
      computationRegistry: r[0],
      dbRegistry: r[1],
    }));
  },

  /**
   * configure a registry that sets up local dbs to be inmem and
   * remote dbs inmem.  the remote dbs will connect to another
   * inmem db (pouchdb-server), simulating a full roundtrip
   * @param {object} opts db-registry config options
   * @returns {DBRegistry}
   */
  getDBRegistry(opts) {
    return dbRegistryFactory({
      isLocal: opts.isLocal,
      isRemote: !opts.isLocal,
      local: { pouchConfig: { adapter: 'memory' } },
      noURLPrefix: true, // disable db pre-fixing (e.g. no `up/`, `down/`)
      path: __dirname,
      remote: {
        pouchConfig: { adapter: 'memory' },
        db: { protocol: 'http', hostname: 'localhost', port: pdbsConfig.port },
      },
    });
  },
};
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
